<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>interface | lei’s blog’</title> <meta name="generator" content="Jekyll v3.9.3" /> <meta property="og:title" content="interface" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="This is lei’s knowledge collection website, not for public use." /> <meta property="og:description" content="This is lei’s knowledge collection website, not for public use." /> <link rel="canonical" href="https://lei0lei.github.io/python/interface" /> <meta property="og:url" content="https://lei0lei.github.io/python/interface" /> <meta property="og:site_name" content="lei’s blog’" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="interface" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"This is lei’s knowledge collection website, not for public use.","headline":"interface","url":"https://lei0lei.github.io/python/interface"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/" class="site-title lh-tight"> lei's blog' </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in DevOps category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/DevOps/" class="nav-list-link">DevOps</a><ul class="nav-list"><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in Git category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/DevOps/Git/" class="nav-list-link">Git</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in Github category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/DevOps/Github/" class="nav-list-link">Github</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in Gitlab category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/DevOps/Gitlab/" class="nav-list-link">Gitlab</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in MLOps category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/DevOps/MLOps/" class="nav-list-link">MLOps</a><ul class="nav-list"></ul></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in MachineLearning category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/MachineLearning/" class="nav-list-link">MachineLearning</a><ul class="nav-list"><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in jax category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/MachineLearning/jax/" class="nav-list-link">jax</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in model category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/MachineLearning/model/" class="nav-list-link">model</a><ul class="nav-list"><li class="nav-list-item "> <a href="/MachineLearning/model/CNN" class="nav-list-link">CNN</a> </li><li class="nav-list-item "> <a href="/MachineLearning/model/GNN" class="nav-list-link">GNN</a> </li><li class="nav-list-item "> <a href="/MachineLearning/model/RNN" class="nav-list-link">RNN</a> </li><li class="nav-list-item "> <a href="/MachineLearning/model/SVM" class="nav-list-link">SVM</a> </li><li class="nav-list-item "> <a href="/MachineLearning/model/Transformer" class="nav-list-link">Transformer</a> </li><li class="nav-list-item "> <a href="/MachineLearning/model/yolo" class="nav-list-link">yolo</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in pytorch category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/MachineLearning/pytorch/" class="nav-list-link">pytorch</a><ul class="nav-list"><li class="nav-list-item "> <a href="/MachineLearning/pytorch/DP" class="nav-list-link">DP</a> </li><li class="nav-list-item "> <a href="/python/DVC" class="nav-list-link">DVC</a> </li><li class="nav-list-item "> <a href="/MachineLearning/pytorch/NN" class="nav-list-link">NN</a> </li><li class="nav-list-item "> <a href="/MachineLearning/pytorch/autograd" class="nav-list-link">autograd</a> </li><li class="nav-list-item "> <a href="/MachineLearning/pytorch/basis" class="nav-list-link">basis</a> </li><li class="nav-list-item "> <a href="/MachineLearning/pytorch/cuda" class="nav-list-link">cuda</a> </li><li class="nav-list-item "> <a href="/MachineLearning/pytorch/frontend" class="nav-list-link">frontend</a> </li><li class="nav-list-item "> <a href="/MachineLearning/pytorch/internal" class="nav-list-link">internal</a> </li><li class="nav-list-item "> <a href="/python/mlflow" class="nav-list-link">mlflow</a> </li><li class="nav-list-item "> <a href="/MachineLearning/pytorch/optimize" class="nav-list-link">optimize</a> </li><li class="nav-list-item "> <a href="/python/pytorch-lightning" class="nav-list-link">pytorch lightning</a> </li><li class="nav-list-item "> <a href="/python/steps2model" class="nav-list-link">steps2model</a> </li></ul></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in cpp category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/cpp/" class="nav-list-link">cpp</a><ul class="nav-list"><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in GSL category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/cpp/GSL/" class="nav-list-link">GSL</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in STL category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/cpp/STL/" class="nav-list-link">STL</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in StandardLibrary category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/cpp/StandardLibrary/" class="nav-list-link">StandardLibrary</a><ul class="nav-list"></ul></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in designpattern category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/designpattern/" class="nav-list-link">designpattern</a><ul class="nav-list"><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in EventDriven category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/designpattern/EventDriven" class="nav-list-link">EventDriven</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in ServiceOriented category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/designpattern/ServiceOriented" class="nav-list-link">ServiceOriented</a><ul class="nav-list"></ul></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in go category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/go/" class="nav-list-link">go</a><ul class="nav-list"></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in howtos category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/how-tos/" class="nav-list-link">howtos</a><ul class="nav-list"><li class="nav-list-item "><a href="/how-tos/github-pages/" class="nav-list-link">howtos-ghpages</a></li></ul></li><li class="nav-list-item"><a href="/micellaneous/" class="nav-list-link">micellaneous</a></li><li class="nav-list-item active"><a href="#" class="nav-list-expander" aria-label="toggle links in python category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/python/" class="nav-list-link">python</a><ul class="nav-list"><li class="nav-list-item "><a href="/python/101" class="nav-list-link">101</a></li><li class="nav-list-item "><a href="/python/DependencyInjector" class="nav-list-link">DependencyInjector</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in DesignPattern category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/python/DesignPattern/" class="nav-list-link">DesignPattern</a><ul class="nav-list"><li class="nav-list-item "> <a href="/MachineLearning/designpattern/functionmethod" class="nav-list-link">Factory Method Pattern</a> </li></ul></li><li class="nav-list-item "><a href="/python/OOP" class="nav-list-link">OOP</a></li><li class="nav-list-item "><a href="/python/asyncio" class="nav-list-link">asyncio</a></li><li class="nav-list-item "><a href="/python/dataclass" class="nav-list-link">dataclass</a></li><li class="nav-list-item "><a href="/python/decorator" class="nav-list-link">decorator</a></li><li class="nav-list-item "><a href="/python/import" class="nav-list-link">import</a></li><li class="nav-list-item active"><a href="/python/interface" class="nav-list-link active">interface</a></li><li class="nav-list-item "><a href="/python/iterator" class="nav-list-link">iterator</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in packages category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/python/packages" class="nav-list-link">packages</a><ul class="nav-list"><li class="nav-list-item "> <a href="/MachineLearning/packages/attrs" class="nav-list-link">attrs</a> </li><li class="nav-list-item "> <a href="/MachineLearning/packages/click" class="nav-list-link">click</a> </li><li class="nav-list-item "> <a href="/MachineLearning/packages/cookiecutter" class="nav-list-link">cookiecutter</a> </li><li class="nav-list-item "> <a href="/MachineLearning/packages/functools" class="nav-list-link">functools</a> </li><li class="nav-list-item "> <a href="/MachineLearning/packages/manim" class="nav-list-link">manim</a> </li><li class="nav-list-item "> <a href="/MachineLearning/packages/numpy" class="nav-list-link">numpy</a> </li><li class="nav-list-item "> <a href="/MachineLearning/packages/pandas" class="nav-list-link">pandas</a> </li><li class="nav-list-item "> <a href="/MachineLearning/packages/pants" class="nav-list-link">pants</a> </li><li class="nav-list-item "> <a href="/MachineLearning/packages/pytest" class="nav-list-link">pytest</a> </li><li class="nav-list-item "> <a href="/MachineLearning/packages/rich" class="nav-list-link">rich</a> </li><li class="nav-list-item "> <a href="/MachineLearning/packages/scipy" class="nav-list-link">scipy</a> </li><li class="nav-list-item "> <a href="/MachineLearning/packages/sqlAlchemy" class="nav-list-link">sqlAlchemy</a> </li><li class="nav-list-item "> <a href="/MachineLearning/packages/tqdm" class="nav-list-link">tqdm</a> </li></ul></li><li class="nav-list-item "><a href="/python/style" class="nav-list-link">python style</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in web category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/web/" class="nav-list-link">web</a><ul class="nav-list"><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in js category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/web/js" class="nav-list-link">js</a><ul class="nav-list"><li class="nav-list-item "> <a href="/web/js/basics" class="nav-list-link">basics</a> </li><li class="nav-list-item "> <a href="/web/js/objects" class="nav-list-link">objects</a> </li><li class="nav-list-item "> <a href="/web/js/styles" class="nav-list-link">styles</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in nodejs category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/web/nodejs" class="nav-list-link">nodejs</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in wasm category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/web/wasm" class="nav-list-link">wasm</a><ul class="nav-list"></ul></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search lei's blog'" aria-label="Search lei's blog'" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/python/">python</a></li> <li class="breadcrumb-nav-list-item"><span>interface</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <details open=""> <summary class="text-delta"> Table of contents </summary> <ol id="markdown-toc"> <li><a href="#概览" id="markdown-toc-概览">概览</a></li> <li><a href="#非正式接口" id="markdown-toc-非正式接口">非正式接口</a></li> <li><a href="#正式接口" id="markdown-toc-正式接口">正式接口</a> <ol> <li><a href="#使用abcabcmeta" id="markdown-toc-使用abcabcmeta">使用<code class="language-plaintext highlighter-rouge">abc.ABCMeta</code></a></li> <li><a href="#使用__subclasshook__" id="markdown-toc-使用__subclasshook__">使用<code class="language-plaintext highlighter-rouge">.__subclasshook__()</code></a></li> <li><a href="#使用abc注册虚拟子类" id="markdown-toc-使用abc注册虚拟子类">使用<code class="language-plaintext highlighter-rouge">abc</code>注册虚拟子类</a> <ol> <li><a href="#使用带注册的子类检测" id="markdown-toc-使用带注册的子类检测">使用带注册的子类检测</a></li> <li><a href="#使用抽象方法声明" id="markdown-toc-使用抽象方法声明">使用抽象方法声明</a></li> </ol> </li> </ol> </li> </ol> </details> <p>本教程中，将会:</p> <ul> <li>理解接口如何工作以及如何创建的</li> <li>理解接口的在动态语言的重要性</li> <li>实现非正式的接口</li> <li>使用<code class="language-plaintext highlighter-rouge">abc.ABCMeta</code>和<code class="language-plaintext highlighter-rouge">@abc.abstractmethod</code>实现正式接口</li> </ul> <h1 id="概览"> <a href="#概览" class="anchor-heading" aria-labelledby="概览"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 概览 </h1> <p>接口式一个设计类的蓝图，像类一样，接口定义了方法，但是这些方法是抽象的，抽象方法是接口定义的但是不由接口进行实现，由类进行实现，给出接口的抽象方法的具体意义。</p> <p>python定义接口与其他语言不同，其他语言可能会有<code class="language-plaintext highlighter-rouge">interface</code>关键字，python没有。</p> <h1 id="非正式接口"> <a href="#非正式接口" class="anchor-heading" aria-labelledby="非正式接口"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 非正式接口 </h1> <p>在一些情况下，可能不需要严格遵守python接口规则，python的动态特征允许我们实现一个非正式的接口。一个非正式的接口是一种可以进行方法覆盖的类，但是没有严格要求。</p> <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">InformalParserInterface</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">load_data_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="s">"""Load in the file for extracting text."""</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">extract_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full_file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="s">"""Extract text from the currently loaded file."""</span>
        <span class="k">pass</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">InformalParserInterface</code>定义了两个方法:<code class="language-plaintext highlighter-rouge">.load_data_source()</code>和<code class="language-plaintext highlighter-rouge">.extract_text()</code>。这些方法定义了但是没有进行实现，在从这个类进行继承创建具体的类时才会进行实现。</p> <p><code class="language-plaintext highlighter-rouge">InformalParserInterface</code>就像一个标准的类一样，需要依靠<code class="language-plaintext highlighter-rouge">duck typing</code>告诉用于这个类应该用作接口。</p> <p>具体类是实现了接口中方法的子类，</p> <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">PdfParser</span><span class="p">(</span><span class="n">InformalParserInterface</span><span class="p">):</span>
    <span class="s">"""Extract text from a PDF"""</span>
    <span class="k">def</span> <span class="nf">load_data_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="s">"""Overrides InformalParserInterface.load_data_source()"""</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">extract_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="s">"""Overrides InformalParserInterface.extract_text()"""</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">EmlParser</span><span class="p">(</span><span class="n">InformalParserInterface</span><span class="p">):</span>
    <span class="s">"""Extract text from an email"""</span>
    <span class="k">def</span> <span class="nf">load_data_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="s">"""Overrides InformalParserInterface.load_data_source()"""</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">extract_text_from_email</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="s">"""A method defined only in EmlParser.
        Does not override InformalParserInterface.extract_text()
        """</span>
        <span class="k">pass</span>
</code></pre></div></div> <p>现在我们定义了接口的两个具体实现，但是<code class="language-plaintext highlighter-rouge">EmlParser</code>没有合适的定义<code class="language-plaintext highlighter-rouge">.extract_text()</code>.要进行检查的话，</p> <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="c1"># Check if both PdfParser and EmlParser implement InformalParserInterface
</span><span class="o">&gt;&gt;&gt;</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">PdfParser</span><span class="p">,</span> <span class="n">InformalParserInterface</span><span class="p">)</span>
<span class="bp">True</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">EmlParser</span><span class="p">,</span> <span class="n">InformalParserInterface</span><span class="p">)</span>
<span class="bp">True</span>
</code></pre></div></div> <p>这可能会出现问题，因为EmlParser没有完整实现接口。可以检查两个子类的mro(method resolution order)：</p> <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">PdfParser</span><span class="p">.</span><span class="n">__mro__</span>
<span class="p">(</span><span class="n">__main__</span><span class="p">.</span><span class="n">PdfParser</span><span class="p">,</span> <span class="n">__main__</span><span class="p">.</span><span class="n">InformalParserInterface</span><span class="p">,</span> <span class="nb">object</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">EmlParser</span><span class="p">.</span><span class="n">__mro__</span>
<span class="p">(</span><span class="n">__main__</span><span class="p">.</span><span class="n">EmlParser</span><span class="p">,</span> <span class="n">__main__</span><span class="p">.</span><span class="n">InformalParserInterface</span><span class="p">,</span> <span class="nb">object</span><span class="p">)</span>
</code></pre></div></div> <p>如果我们想要<code class="language-plaintext highlighter-rouge">issubclass(EmlParser, InformalParserInterface)</code>返回False,可以创建<code class="language-plaintext highlighter-rouge">metaclass</code>来覆盖两个dunder方法:</p> <ol> <li><code class="language-plaintext highlighter-rouge">.__instancecheck__()</code></li> <li><code class="language-plaintext highlighter-rouge">.__subclasscheck__()</code></li> </ol> <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ParserMeta</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="s">"""A Parser metaclass that will be used for parser class creation.
    """</span>
    <span class="k">def</span> <span class="nf">__instancecheck__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">.</span><span class="n">__subclasscheck__</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">instance</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__subclasscheck__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">subclass</span><span class="p">,</span> <span class="s">'load_data_source'</span><span class="p">)</span> <span class="ow">and</span> 
                <span class="nb">callable</span><span class="p">(</span><span class="n">subclass</span><span class="p">.</span><span class="n">load_data_source</span><span class="p">)</span> <span class="ow">and</span> 
                <span class="nb">hasattr</span><span class="p">(</span><span class="n">subclass</span><span class="p">,</span> <span class="s">'extract_text'</span><span class="p">)</span> <span class="ow">and</span> 
                <span class="nb">callable</span><span class="p">(</span><span class="n">subclass</span><span class="p">.</span><span class="n">extract_text</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">UpdatedInformalParserInterface</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">ParserMeta</span><span class="p">):</span>
    <span class="s">"""This interface is used for concrete classes to inherit from.
    There is no need to define the ParserMeta methods as any class
    as they are implicitly made available via .__subclasscheck__().
    """</span>
    <span class="k">pass</span>
</code></pre></div></div> <p>下面是具体的实现:</p> <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">PdfParserNew</span><span class="p">:</span>
    <span class="s">"""Extract text from a PDF."""</span>
    <span class="k">def</span> <span class="nf">load_data_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="s">"""Overrides UpdatedInformalParserInterface.load_data_source()"""</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">extract_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="s">"""Overrides UpdatedInformalParserInterface.extract_text()"""</span>
        <span class="k">pass</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">PdfParserNew</code>重写了两个方法因此<code class="language-plaintext highlighter-rouge">issubclass(PdfParserNew, UpdatedInformalParserInterface)</code>返回True.</p> <p>使用metaclass，不需要明确的定义子类，子类必须定义对应的方法否则<code class="language-plaintext highlighter-rouge">issubclass(EmlParserNew, UpdatedInformalParserInterface)</code>会返回False.</p> <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">PdfParserNew</span><span class="p">,</span> <span class="n">UpdatedInformalParserInterface</span><span class="p">)</span>
<span class="bp">True</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">EmlParserNew</span><span class="p">,</span> <span class="n">UpdatedInformalParserInterface</span><span class="p">)</span>
<span class="bp">False</span>
</code></pre></div></div> <p>现在看一下MRO：</p> <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">PdfParserNew</span><span class="p">.</span><span class="n">__mro__</span>
<span class="p">(</span><span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">__main__</span><span class="p">.</span><span class="n">PdfParserNew</span><span class="s">'&gt;, &lt;class '</span><span class="nb">object</span><span class="s">'&gt;)
</span></code></pre></div></div> <p>可以看出<code class="language-plaintext highlighter-rouge">UpdatedInformalParserInterface</code>是<code class="language-plaintext highlighter-rouge">PdfParserNew</code>的父类，但是并没有出现在MRO中，因为<code class="language-plaintext highlighter-rouge">UpdatedInformalParserInterface</code>是<code class="language-plaintext highlighter-rouge">PdfParserNew</code>。</p> <p>这种写法和标准的子类方式的区别在于虚基类使用了<code class="language-plaintext highlighter-rouge">.__subclasscheck__()</code>dunder方法来隐式的检查一个类是否是父类的虚拟子类，另外虚拟基类不会出现在子类的MRO中。</p> <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">PersonMeta</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="s">"""A person metaclass"""</span>
    <span class="k">def</span> <span class="nf">__instancecheck__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">.</span><span class="n">__subclasscheck__</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">instance</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__subclasscheck__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">subclass</span><span class="p">,</span> <span class="s">'name'</span><span class="p">)</span> <span class="ow">and</span> 
                <span class="nb">callable</span><span class="p">(</span><span class="n">subclass</span><span class="p">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">and</span> 
                <span class="nb">hasattr</span><span class="p">(</span><span class="n">subclass</span><span class="p">,</span> <span class="s">'age'</span><span class="p">)</span> <span class="ow">and</span> 
                <span class="nb">callable</span><span class="p">(</span><span class="n">subclass</span><span class="p">.</span><span class="n">age</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">PersonSuper</span><span class="p">:</span>
    <span class="s">"""A person superclass"""</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">age</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">PersonMeta</span><span class="p">):</span>
    <span class="s">"""Person interface built from PersonMeta metaclass."""</span>
    <span class="k">pass</span>
</code></pre></div></div> <ol> <li>metaclass <code class="language-plaintext highlighter-rouge">PersonMeta</code></li> <li>基类 <code class="language-plaintext highlighter-rouge">PersonSuper</code></li> <li>接口 <code class="language-plaintext highlighter-rouge">Person</code></li> </ol> <p>创建完虚基类之后可以定义两个具体类，<code class="language-plaintext highlighter-rouge">Employee</code>继承自<code class="language-plaintext highlighter-rouge">PersonSuper</code>，<code class="language-plaintext highlighter-rouge">Friend</code>隐式的继承自<code class="language-plaintext highlighter-rouge">Person</code>.</p> <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Inheriting subclasses
</span><span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="n">PersonSuper</span><span class="p">):</span>
    <span class="s">"""Inherits from PersonSuper
    PersonSuper will appear in Employee.__mro__
    """</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Friend</span><span class="p">:</span>
    <span class="s">"""Built implicitly from Person
    Friend is a virtual subclass of Person since
    both required methods exist.
    Person not in Friend.__mro__
    """</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">age</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</code></pre></div></div> <p>尽管<code class="language-plaintext highlighter-rouge">Friend</code>没有明确的继承自<code class="language-plaintext highlighter-rouge">Person</code>,它实现了<code class="language-plaintext highlighter-rouge">.name()</code>和<code class="language-plaintext highlighter-rouge">.age()</code>，因此变成了<code class="language-plaintext highlighter-rouge">Friend</code>的虚基类，在运行<code class="language-plaintext highlighter-rouge">issubclass(Friend, Person)</code>的时候应该返回True.</p> <p><img src="https://files.realpython.com/media/virtual-base-class.b545144aafef.png" alt="UML" /></p> <p>查看一下<code class="language-plaintext highlighter-rouge">PersonMeta</code>,将会发现由另一个dunder方法<code class="language-plaintext highlighter-rouge">__instancecheck__()</code>,这个方法用来检查Friend的实力是否是从<code class="language-plaintext highlighter-rouge">Person</code>接口创建的实例。在使用<code class="language-plaintext highlighter-rouge">isinstance(Friend, Person)</code>的时候会调用该方法。</p> <h1 id="正式接口"> <a href="#正式接口" class="anchor-heading" aria-labelledby="正式接口"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 正式接口 </h1> <p>开发者较少时非正式的接口比较有用，但是对于打的应用需要创建正式的python接口，这需要从<code class="language-plaintext highlighter-rouge">abc</code>模块中拿一些工具来用。</p> <h2 id="使用abcabcmeta"> <a href="#使用abcabcmeta" class="anchor-heading" aria-labelledby="使用abcabcmeta"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 使用<code class="language-plaintext highlighter-rouge">abc.ABCMeta</code> </h2> <p>为了强制子类实例化抽象方法，需要利用内建的<code class="language-plaintext highlighter-rouge">abc</code>模块中的<code class="language-plaintext highlighter-rouge">ABCMeta</code>. 回到之前的<code class="language-plaintext highlighter-rouge">UpdatedInformalParserInterface</code>接口，我们创建了自己的metaclass：<code class="language-plaintext highlighter-rouge">ParserMeta</code>，重写了dunder方法:<code class="language-plaintext highlighter-rouge">.__instancecheck__()</code>和<code class="language-plaintext highlighter-rouge">.__subclasscheck__()</code>。</p> <p>除了自己创建metaclass,可以使用<code class="language-plaintext highlighter-rouge">abc.ABCMeta</code>作为metaclass.然后重写<code class="language-plaintext highlighter-rouge">.__subclasshook__()</code>替代<code class="language-plaintext highlighter-rouge">.__instancecheck__()</code>和<code class="language-plaintext highlighter-rouge">.__subclasscheck__()</code>,subclasshook的实现更加可靠。</p> <h2 id="使用__subclasshook__"> <a href="#使用__subclasshook__" class="anchor-heading" aria-labelledby="使用__subclasshook__"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 使用<code class="language-plaintext highlighter-rouge">.__subclasshook__()</code> </h2> <p>下面是使用<code class="language-plaintext highlighter-rouge">abc.ABCMeta</code>作为metaclass的<code class="language-plaintext highlighter-rouge">FormalParserInterface</code>实现。</p> <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">abc</span>

<span class="k">class</span> <span class="nc">FormalParserInterface</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">abc</span><span class="p">.</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="o">@</span><span class="nb">classmethod</span>
    <span class="k">def</span> <span class="nf">__subclasshook__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">subclass</span><span class="p">,</span> <span class="s">'load_data_source'</span><span class="p">)</span> <span class="ow">and</span> 
                <span class="nb">callable</span><span class="p">(</span><span class="n">subclass</span><span class="p">.</span><span class="n">load_data_source</span><span class="p">)</span> <span class="ow">and</span> 
                <span class="nb">hasattr</span><span class="p">(</span><span class="n">subclass</span><span class="p">,</span> <span class="s">'extract_text'</span><span class="p">)</span> <span class="ow">and</span> 
                <span class="nb">callable</span><span class="p">(</span><span class="n">subclass</span><span class="p">.</span><span class="n">extract_text</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">PdfParserNew</span><span class="p">:</span>
    <span class="s">"""Extract text from a PDF."""</span>
    <span class="k">def</span> <span class="nf">load_data_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="s">"""Overrides FormalParserInterface.load_data_source()"""</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">extract_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="s">"""Overrides FormalParserInterface.extract_text()"""</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">EmlParserNew</span><span class="p">:</span>
    <span class="s">"""Extract text from an email."""</span>
    <span class="k">def</span> <span class="nf">load_data_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="s">"""Overrides FormalParserInterface.load_data_source()"""</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">extract_text_from_email</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="s">"""A method defined only in EmlParser.
        Does not override FormalParserInterface.extract_text()
        """</span>
        <span class="k">pass</span>
</code></pre></div></div> <p>如果在<code class="language-plaintext highlighter-rouge">PdfParserNew</code>和<code class="language-plaintext highlighter-rouge">EmlParserNew</code>上运行<code class="language-plaintext highlighter-rouge">issubclass()</code>，将会返回True和False.</p> <h2 id="使用abc注册虚拟子类"> <a href="#使用abc注册虚拟子类" class="anchor-heading" aria-labelledby="使用abc注册虚拟子类"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 使用<code class="language-plaintext highlighter-rouge">abc</code>注册虚拟子类 </h2> <p>import <code class="language-plaintext highlighter-rouge">abc</code>模块之后，可以直接使用<code class="language-plaintext highlighter-rouge">.register()</code>元方法注册虚拟子类，这一个例子注册了一个<code class="language-plaintext highlighter-rouge">Doblue</code>接口作为内建的<code class="language-plaintext highlighter-rouge">__float__</code>类的虚拟基类。</p> <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Double</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">abc</span><span class="p">.</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="s">"""Double precision floating point number."""</span>
    <span class="k">pass</span>

<span class="n">Double</span><span class="p">.</span><span class="n">register</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</code></pre></div></div> <p>可以使用<code class="language-plaintext highlighter-rouge">.register()</code>检查效果，</p> <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="nb">issubclass</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">Double</span><span class="p">)</span>
<span class="bp">True</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nb">isinstance</span><span class="p">(</span><span class="mf">1.2345</span><span class="p">,</span> <span class="n">Double</span><span class="p">)</span>
<span class="bp">True</span>
</code></pre></div></div> <p>通过使用<code class="language-plaintext highlighter-rouge">.register()</code>元方法，注册了一个<code class="language-plaintext highlighter-rouge">float</code>的虚拟子类<code class="language-plaintext highlighter-rouge">Double</code>.</p> <p>可以使用类装饰其将被装饰的类设置为虚拟子类，</p> <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">Double</span><span class="p">.</span><span class="n">register</span>
<span class="k">class</span> <span class="nc">Double64</span><span class="p">:</span>
    <span class="s">"""A 64-bit double-precision floating-point number."""</span>
    <span class="k">pass</span>

<span class="k">print</span><span class="p">(</span><span class="nb">issubclass</span><span class="p">(</span><span class="n">Double64</span><span class="p">,</span> <span class="n">Double</span><span class="p">))</span>  <span class="c1"># True
</span></code></pre></div></div> <h3 id="使用带注册的子类检测"> <a href="#使用带注册的子类检测" class="anchor-heading" aria-labelledby="使用带注册的子类检测"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 使用带注册的子类检测 </h3> <p>在结合使用<code class="language-plaintext highlighter-rouge">.__subclasshook__()</code>和<code class="language-plaintext highlighter-rouge">.register()</code>的时候必须小心，因为<code class="language-plaintext highlighter-rouge">.__subclasshook__()</code>的优先级高于虚拟子类注册。为了确保注册的虚拟子类生效必须给<code class="language-plaintext highlighter-rouge">.__subclasshook__()</code>方法添加<code class="language-plaintext highlighter-rouge">NotImplemented</code>.更新后的<code class="language-plaintext highlighter-rouge">FormalParserInterface</code>为:</p> <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">FormalParserInterface</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">abc</span><span class="p">.</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="o">@</span><span class="nb">classmethod</span>
    <span class="k">def</span> <span class="nf">__subclasshook__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">subclass</span><span class="p">,</span> <span class="s">'load_data_source'</span><span class="p">)</span> <span class="ow">and</span> 
                <span class="nb">callable</span><span class="p">(</span><span class="n">subclass</span><span class="p">.</span><span class="n">load_data_source</span><span class="p">)</span> <span class="ow">and</span> 
                <span class="nb">hasattr</span><span class="p">(</span><span class="n">subclass</span><span class="p">,</span> <span class="s">'extract_text'</span><span class="p">)</span> <span class="ow">and</span> 
                <span class="nb">callable</span><span class="p">(</span><span class="n">subclass</span><span class="p">.</span><span class="n">extract_text</span><span class="p">)</span> <span class="ow">or</span> 
                <span class="nb">NotImplemented</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">PdfParserNew</span><span class="p">:</span>
    <span class="s">"""Extract text from a PDF."""</span>
    <span class="k">def</span> <span class="nf">load_data_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="s">"""Overrides FormalParserInterface.load_data_source()"""</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">extract_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="s">"""Overrides FormalParserInterface.extract_text()"""</span>
        <span class="k">pass</span>

<span class="o">@</span><span class="n">FormalParserInterface</span><span class="p">.</span><span class="n">register</span>
<span class="k">class</span> <span class="nc">EmlParserNew</span><span class="p">:</span>
    <span class="s">"""Extract text from an email."""</span>
    <span class="k">def</span> <span class="nf">load_data_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="s">"""Overrides FormalParserInterface.load_data_source()"""</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">extract_text_from_email</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="s">"""A method defined only in EmlParser.
        Does not override FormalParserInterface.extract_text()
        """</span>
        <span class="k">pass</span>

<span class="k">print</span><span class="p">(</span><span class="nb">issubclass</span><span class="p">(</span><span class="n">PdfParserNew</span><span class="p">,</span> <span class="n">FormalParserInterface</span><span class="p">))</span>  <span class="c1"># True
</span><span class="k">print</span><span class="p">(</span><span class="nb">issubclass</span><span class="p">(</span><span class="n">EmlParserNew</span><span class="p">,</span> <span class="n">FormalParserInterface</span><span class="p">))</span>  <span class="c1"># True
</span></code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">EmlParserNew</code>被认为是<code class="language-plaintext highlighter-rouge">FormalParserInterface</code>接口的虚拟子类。这出现了一点问题因为<code class="language-plaintext highlighter-rouge">EmlParserNew</code>没有覆盖<code class="language-plaintext highlighter-rouge">.extract_text()</code>.使用虚拟子类注册一定要小心。</p> <h3 id="使用抽象方法声明"> <a href="#使用抽象方法声明" class="anchor-heading" aria-labelledby="使用抽象方法声明"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 使用抽象方法声明 </h3> <p>抽象方法是python接口声明的方法，但是没有一个有用的实现。抽象方法必须被实现了接口的具体类进行重写。</p> <p>要在python中创建抽象方法，将<code class="language-plaintext highlighter-rouge">@abc.abstractmethod</code>装饰其添加到接口的方法中，在下一个例子中，更改<code class="language-plaintext highlighter-rouge">FormalParserInterface</code>来包含抽象方法<code class="language-plaintext highlighter-rouge">.load_data_source()</code>和<code class="language-plaintext highlighter-rouge">.extract_text()</code>.</p> <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">FormalParserInterface</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">abc</span><span class="p">.</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="o">@</span><span class="nb">classmethod</span>
    <span class="k">def</span> <span class="nf">__subclasshook__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">subclass</span><span class="p">,</span> <span class="s">'load_data_source'</span><span class="p">)</span> <span class="ow">and</span> 
                <span class="nb">callable</span><span class="p">(</span><span class="n">subclass</span><span class="p">.</span><span class="n">load_data_source</span><span class="p">)</span> <span class="ow">and</span> 
                <span class="nb">hasattr</span><span class="p">(</span><span class="n">subclass</span><span class="p">,</span> <span class="s">'extract_text'</span><span class="p">)</span> <span class="ow">and</span> 
                <span class="nb">callable</span><span class="p">(</span><span class="n">subclass</span><span class="p">.</span><span class="n">extract_text</span><span class="p">)</span> <span class="ow">or</span> 
                <span class="nb">NotImplemented</span><span class="p">)</span>

    <span class="o">@</span><span class="n">abc</span><span class="p">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">load_data_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="s">"""Load in the data set"""</span>
        <span class="k">raise</span> <span class="nb">NotImplementedError</span>

    <span class="o">@</span><span class="n">abc</span><span class="p">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">extract_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="s">"""Extract text from the data set"""</span>
        <span class="k">raise</span> <span class="nb">NotImplementedError</span>

<span class="k">class</span> <span class="nc">PdfParserNew</span><span class="p">(</span><span class="n">FormalParserInterface</span><span class="p">):</span>
    <span class="s">"""Extract text from a PDF."""</span>
    <span class="k">def</span> <span class="nf">load_data_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="s">"""Overrides FormalParserInterface.load_data_source()"""</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">extract_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="s">"""Overrides FormalParserInterface.extract_text()"""</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">EmlParserNew</span><span class="p">(</span><span class="n">FormalParserInterface</span><span class="p">):</span>
    <span class="s">"""Extract text from an email."""</span>
    <span class="k">def</span> <span class="nf">load_data_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="s">"""Overrides FormalParserInterface.load_data_source()"""</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">extract_text_from_email</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="s">"""A method defined only in EmlParser.
        Does not override FormalParserInterface.extract_text()
        """</span>
        <span class="k">pass</span>
</code></pre></div></div> <p>在上边的例子中，最终创建了一个正式接口，当抽象方法没有被重写时会报错。</p> <p><code class="language-plaintext highlighter-rouge">PdfParserNew</code>实例<code class="language-plaintext highlighter-rouge">pdf_parser</code>不会报错，因为<code class="language-plaintext highlighter-rouge">PdfParserNew</code>正确重写了<code class="language-plaintext highlighter-rouge">FormalParserInterface</code>的抽象方法，但是<code class="language-plaintext highlighter-rouge">EmlParserNew</code>会报错:</p> <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">pdf_parser</span> <span class="o">=</span> <span class="n">PdfParserNew</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">eml_parser</span> <span class="o">=</span> <span class="n">EmlParserNew</span><span class="p">()</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">"real_python_interfaces.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">53</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="n">eml_interface</span> <span class="o">=</span> <span class="n">EmlParserNew</span><span class="p">()</span>
<span class="nb">TypeError</span><span class="p">:</span> <span class="n">Can</span><span class="s">'t instantiate abstract class EmlParserNew with abstract methods extract_text
</span></code></pre></div></div> <p>回溯消息告诉我们没有覆盖所有的抽象方法，这就是一个正式的python接口。</p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
